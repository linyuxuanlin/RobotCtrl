---
id: 设计文档
title: 设计文档
---

## 参考与致谢

- [STM32 的 PDR_ON 引脚，比较好的解释（转载+补充）](https://blog.csdn.net/Frankenstien_/article/details/105971841)
- [正点原子【STM32-F407 探索者】第五十六章 USB 读卡器(Slave)实验](https://zhuanlan.zhihu.com/p/136163591)

## Power

电源采用双 XT60 端口输入，拓扑图请见本目录下 `PowerTree.drawio` 文件。

### 电源保护

过压过流保护：使用 TVS 管和保险丝实现瞬时过电压和过电流保护

过流保护：使用 Littelfuse 的 0437007.WR 型号保险丝，参数如下：

- 一次性保险丝，快断
- 熔断 I²t：5.02
- 标称电压降：130mV
- 额定电压 DC：35V
- 额定电流：7A
- 分断能力 50A

防反接保护：使用 SS56 肖特基二极管防反接保护

### 24V 转 12V 隔离稳压

选用金升阳 URB2412LD-30WR3 DC/DC 隔离电源模块。参数如下：

- 输入电压 24VDC（范围值 9-36V，最大值 40V）
- 输出电压 12VDC
- 输出电流 2.5A
- 满载效率 88%（Min）/90%（Typ）
- 最大容性负载 2700uF
- 启动电压 9VDC
- 不支持输出并联升功率

遥控脚（Ctrl）的使用方法：

- 模块开启：Ctrl 悬空或接 TTL 高电平（3.5-12 VDC）
- 模块关断：Ctrl 接 GND 或低电平（0-1.2 VDC）

### 12V 输出（WJ2EDGRC-5.08-2P）

两个。

### 24V 转 5V 隔离稳压

选用金升阳 URB2405YMD-15WR3 DC/DC 隔离电源模块。参数如下：

- 输入电压 24VDC（范围值 9-36V，最大值 40V）
- 输出电压 5VDC
- 输出电流 3A
- 满载效率 88%（Min）/90%（Typ）
- 最大容性负载 4700uF
- 启动电压 9VDC
- 不支持输出并联升功率

遥控脚（Ctrl）的使用方法：

- 模块开启：Ctrl 悬空或接 TTL 高电平（3.5-12VDC）
- 模块关断：Ctrl 接 GND 或低电平（0-1.2VDC）

### 5V 转 3.3V 线性稳压

5V 转 3.3V 电路选用 AMS1117-3.3 这款 LDO，输出 1A 的电流已足够主控及外围元器件使用。输入输出前后并联 10uF 与 100nF 陶瓷贴片电容以去耦。

### 电源指示 LED

电源 LED 指示灯显示 3.3V 电源的状态。

---

## MCU

### 启动模式

- 选择从主闪存存储器启动，即 BOOT0 串接 10 K 的下拉电阻，BOOT1 任意。

### 外部高速时钟（HSE）

- 选用村田 8M 晶振。

### 去耦电容

- VDD：总的一个 10 μF 的陶瓷电容，外加每个 VDD 引脚旁接一个 100 nF 陶瓷电容。
- VDDA：100 nF 陶瓷电容 + 1 µF 陶瓷电容。

### VCAP 电容

- 各对地接一个 2.2 µF 陶瓷电容

### 复位电路

- 启用电源监控器：PDR_ON 通过 120Ω 电阻上拉。
- 添加按键复位按键

### 下载调试接口

- 直接引出，不需要外部上拉／下拉电阻（因为 STM32 内部有集成）。

## Dev

### USB

STM32F407 系列芯片支持 USB OTG FS（FS 即全速 12Mbps），其 USB 符合 USB2.0 规范。

标准 USB 共四根线组成，除两根电源线外，另外两根线为 D+ 和 D-，这两根数据线采用的是差分电压的方式进行数据传输的。作为主机时，D- 和 D+ 都接 15k 的电阻到地，所以在没有设备接入的时候，D+ 和 D- 均为低电平。而在 USB 从机（设备）中，如果是高速设备，则在 D+ 上接一个 1.5k 的上拉电阻，而如果是低速设备，则在 D- 上接一个 1.5k 的上拉电阻。这样当设备接入主机的时候，主机就可以判断是否有设备接入，并能判断设备是高速设备还是低速设备。

在本项目的设计中，作为 USB OTG FS 使用，可以在 STM32F407ZE 的数据手册中找到设计参考：

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20210915215808.png)

需要注意的是，引脚需要加 TVS 二极管以防止瞬态电压损坏 GPIO，且信号线需要进行差分等长布线。

### 串口转 RS232（DB9）

使用 SP3232EEN 串口转 RS232 芯片，使用 DB9 母座用于连接工控机。

### 用户 GPIO 接口

引出 PG3-PG8 GPIO 给用户自定义使用。

### 用户按钮

2 个用户按钮接在 PE2 和 PE3，有硬件防抖，需设置内部上拉输入，按下为低电平。

### 用户 LED

3 个用户 LED 接在 PC6、PC7、PC8 引脚，输入高电平可点亮。

### 红外光电接口

预留 4 个供红外光电传感器的端口，信号分别连接在 PF2、PF3、PF4、PF5，供电为 12V。

### 超声波测距接口

改为 5 个 HC-SR04（4 口），TRIG 为发射，ECHO 为接收，接 5V。

### 蜂鸣器

用 S9013 NPN 管驱动，高电平激活，接在单片机 PC9 引脚。

### 陀螺仪

陀螺仪使用 WT931 九轴姿态角度传感器模块，使用 I2C 与单品机进行通信（I2C2_SDA/PF0，I2C2_SCL/PF1）。

### CAN（2 路）

https://wiki-power.com/%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1-CAN%E9%80%9A%E4%BF%A1#%E5%9F%BA%E4%BA%8E-tja1050

### 网口